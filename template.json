{
    "variables": {
        "iso_url": "https://mirrors.kernel.org/archlinux/iso/{{isotime \"2006.01\"}}.01/archlinux-{{isotime \"2006.01\"}}.01-x86_64.iso",
        "iso_checksum_url": "https://mirrors.kernel.org/archlinux/iso/{{isotime \"2006.01\"}}.01/sha1sums.txt",
        "guest_additions_url": "https://download.virtualbox.org/virtualbox/6.1.22/VBoxGuestAdditions_6.1.22.iso",
        "guest_additions_sha256": "bffc316a7b8d5ed56d830e9f6aef02b4e5ffc28674032142e96ffbedd905f8c9",
        "country": "US",
        "write_zeros": "true",
        "ssh_user": "vagrant",
        "ssh_password": "vagrant"
    },
    "builders": [
        {
            "type": "virtualbox-iso",
            "name": "playground-arch",
            "vm_name": "playground-arch",
            "output_directory": "output/playground-arch",
            "iso_url": "{{ user `iso_url` }}",
            "iso_checksum": "file:{{ user `iso_checksum_url` }}",
            "guest_os_type": "ArchLinux_64",
            "guest_additions_mode": "upload",
            "http_directory": "http",
            "boot_wait": "5s",
            "boot_command": [
                "curl -O 'http://{{.HTTPIP}}:{{.HTTPPort}}/playground.arch.vagrant{,.chroot}.sh'<enter><wait>",
                "bash playground.arch.vagrant.sh < playground.arch.vagrant.chroot.sh && systemctl reboot<enter>"
            ],
            "cpus": 2,
            "memory": 2048,
            "vboxmanage": [
                [
                    "modifyvm",
                    "{{.Name}}",
                    "--vram",
                    "64"
                ]
            ],
            "disk_size": 20480,
            "hard_drive_interface": "sata",
            "ssh_username": "{{ user `ssh_user` }}",
            "ssh_password": "{{ user `ssh_password` }}",
            "ssh_port": 22,
            "ssh_timeout": "20m",
            "shutdown_command": " '{{ user `ssh_user` }}' | sudo -S shutdown -P now",
            "guest_additions_url": "https://download.virtualbox.org/virtualbox/6.1.22/VBoxGuestAdditions_6.1.22.iso",
            "guest_additions_sha256": "bffc316a7b8d5ed56d830e9f6aef02b4e5ffc28674032142e96ffbedd905f8c9",
            "headless": "false",
            "virtualbox_version_file": "VBoxVersion.txt"
        }
    ],
    "provisioners": [
        {
            "scripts": [
                "scripts/arch/pacman.sh"
            ],
            "type": "shell",
            "timeout": "120m",
            "execute_command": "{{ .Vars }} sudo -E -S bash '{{ .Path }}'",
            "start_retry_timeout": "15m",
            "expect_disconnect": "true",
            "only": [
                "playground-arch"
            ]
        },
        {
            "scripts": [
                "scripts/arch/virtualbox.sh",
                "scripts/arch/cleanup.sh"
            ],
            "type": "shell",
            "timeout": "120m",
            "execute_command": "{{ .Vars }} sudo -E -S bash '{{ .Path }}'",
            "pause_before": "120s",
            "start_retry_timeout": "15m",
            "expect_disconnect": "true",
            "only": [
                "playground-arch"
            ]
        }
    ],
    "post-processors": [
        {
            "type": "vagrant",
            "compression_level": 9,
            "keep_input_artifact": false,
            "vagrantfile_template": "arch_vagrant.rb",
            "include": [
                "info.json"
            ],
            "output": "output/playground_arch_{{ .Provider }}-{{isotime \"2006.01\"}}.01.box"
        }
    ]
}